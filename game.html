<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>輪投げゲーム</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #38b43d; /* 芝生の色 */
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        #game-container {
            position: relative;
        }
        canvas {
            display: block;
            border: 5px solid #287a2b;
            background-color: #5cb85c; /* 明るい地面の色 */
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5) inset;
        }
        #score-board {
            /* 中央上部配置と文字化け対策 */
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(255, 255, 255, 0.9);
            padding: 10px 20px;
            border-radius: 8px;
            /*  文字化け対策フォント群  */
            font-family: 'Hiragino Kaku Gothic Pro', 'Meiryo', 'MS Gothic', sans-serif; 
            font-size: 24px;
            font-weight: bold;
            color: #333;
            z-index: 10;
            display: flex;
            gap: 30px;
            white-space: nowrap;
        }
        #throw-guide {
            /* 投げる方向と強さを示すガイドライン */
            position: absolute;
            width: 0;
            height: 0;
            border-bottom: 2px dashed #ffff00;
            transform-origin: 0 0;
            pointer-events: none;
            z-index: 20;
        }
        /* クリック可能エリアを示す半透明の帯 */
        #launch-area-guide {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 200px;
            background-color: rgba(255, 255, 255, 0.1); 
            pointer-events: none; 
            z-index: 5;
        }
    </style>
</head>
<body>

<div id="game-container">
    <div id="score-board">
        <div>スコア: <span id="score">0</span> 点</div>
        <div>残りタイム: <span id="timer">60.00</span> 秒</div>
    </div>
    <div id="launch-area-guide"></div> 
    <div id="throw-guide"></div> 
    <canvas id="ringTossCanvas"></canvas>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const canvas = document.getElementById('ringTossCanvas');
        const ctx = canvas.getContext('2d');
        const guideElement = document.getElementById('throw-guide');
        
        // ゲームの定数
        const CANVAS_WIDTH = 1000;
        const CANVAS_HEIGHT = 600;
        const TOTAL_TIME = 60; 
        const RING_RADIUS = 25;
        
        //  空気中の物理演算 
        const AIR_DRAG = 0.998; 
        const GRAVITY = 0.5; 
        const MAX_THROW_FORCE = 35; 
        const LAUNCH_AREA_HEIGHT = 200; 
        const NUM_POSTS = 10; //  棒の数 

        // ゲームの状態
        let score = 0;
        let timeRemaining = TOTAL_TIME;
        let gameActive = true;
        let gameInterval;
        let rings = [];
        let posts = [];
        
        let isDragging = false;
        let launchPos = { x: 0, y: 0 }; 

        // UI要素
        const scoreElement = document.getElementById('score');
        const timerElement = document.getElementById('timer');

        canvas.width = CANVAS_WIDTH;
        canvas.height = CANVAS_HEIGHT;

        // --- ゲーム要素のクラス定義 ---
        class Post {
            constructor(x, height) {
                this.x = x;
                this.y = CANVAS_HEIGHT; 
                this.width = 10;
                this.height = height; 
                this.scoreValue = 1; 
                this.color = '#ffaa00';
            }
            draw() {
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x - this.width / 2, this.y - this.height, this.width, this.height);
            }
        }

        class Ring {
            constructor(startX, startY) {
                this.x = startX;
                this.y = startY;
                this.radius = RING_RADIUS;
                this.color = '#ff5555';
                this.vx = 0;
                this.vy = 0;
                this.isTossed = false;
                this.isScored = false;
            }
            update() {
                if (!this.isTossed || this.isScored) return;
                
                this.vx *= AIR_DRAG; 
                this.vy *= AIR_DRAG;
                this.vy += GRAVITY; 

                this.x += this.vx;
                this.y += this.vy;
                
                // 画面端の跳ね返り (左右)
                if (this.x - this.radius < 0 || this.x + this.radius > CANVAS_WIDTH) {
                    this.vx *= -0.5; 
                    this.x = Math.max(this.radius, Math.min(this.x, CANVAS_WIDTH - this.radius));
                }
                
                // 床に当たったら跳ね返り
                if (this.y + this.radius > CANVAS_HEIGHT) {
                    this.y = CANVAS_HEIGHT - this.radius;
                    this.vy *= -0.3; 
                    this.vx *= 0.6; 
                    
                    if (Math.abs(this.vy) < 0.5 && Math.abs(this.vx) < 0.5) {
                        this.isTossed = false; 
                    }
                }
            }
            draw() {
                ctx.strokeStyle = this.color;
                ctx.lineWidth = 5;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.stroke();
            }
        }
        // ------------------------------------------

        function initializePosts() {
            posts = []; 
            const spacing = CANVAS_WIDTH / (NUM_POSTS + 1); 
            
            for (let i = 1; i <= NUM_POSTS; i++) {
                const x = spacing * i;
                const height = Math.random() * 200 + 100; 
                posts.push(new Post(x, height));
            }
        }
        
        function checkCollisions(ring) {
            if (ring.isScored) return;
            for (const post of posts) {
                // 当たり判定ロジック
                const isWithinX = Math.abs(ring.x - post.x) < post.width / 2;
                const isBelowTop = ring.y + ring.radius > post.y - post.height;
                const isAboveTop = ring.y - ring.radius < post.y - post.height;
                
                if (isWithinX && isBelowTop && isAboveTop) {
                    score += post.scoreValue;
                    scoreElement.textContent = score;
                    ring.isScored = true;
                    ring.color = '#33cc33';
                    // 棒に刺さったら動きを止める
                    ring.isTossed = false;
                    ring.vy = 0;
                    ring.vx = 0;
                    ring.y = post.y - post.height + RING_RADIUS;
                    return;
                }
            }
        }

        function updateGame() {
            if (!gameActive) return;
            timeRemaining -= 0.1;
            if (timeRemaining <= 0) {
                timeRemaining = 0;
                timerElement.textContent = '0.00';
